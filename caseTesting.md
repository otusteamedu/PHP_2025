Тестовые сценарии для системы оплаты просмотра фильмов
1. Модульные тесты (Unit Tests)
Тестирование валидации данных
a. Валидация card_number:

Если card_number содержит менее 16 цифр - возвращается 400 с ошибкой "Неверный номер карты"

Если card_number содержит более 16 цифр - возвращается 400 с ошибкой "Неверный номер карты"

Если card_number содержит нецифровые символы - возвращается 400 с ошибкой "Неверный номер карты"

Если card_number равен null - возвращается 400 с ошибкой "Неверный номер карты"

b. Валидация card_holder:

Если card_holder содержит более одного пробела - возвращается 400 с ошибкой "Неверное имя владельца карты"

Если card_holder содержит кириллические символы - возвращается 400 с ошибкой "Неверное имя владельца карты"

Если card_holder содержит цифры - возвращается 400 с ошибкой "Неверное имя владельца карты"

Если card_holder содержит специальные символы (кроме дефиса) - возвращается 400 с ошибкой "Неверное имя владельца карты"

Если card_holder равен null - возвращается 400 с ошибкой "Неверное имя владельца карты"

c. Валидация card_expiration:

Если card_expiration в неправильном формате (не мм/гг) - возвращается 400 с ошибкой "Неверный срок действия карты"

Если месяц больше 12 - возвращается 400 с ошибкой "Неверный срок действия карты"

Если срок действия карты истёк - возвращается 400 с ошибкой "Срок действия карты истёк"

Если card_expiration равен null - возвращается 400 с ошибкой "Неверный срок действия карты"

d. Валидация cvv:

Если cvv содержит менее 3 цифр - возвращается 400 с ошибкой "Неверный CVV код"

Если cvv содержит более 3 цифр - возвращается 400 с ошибкой "Неверный CVV код"

Если cvv содержит нецифровые символы - возвращается 400 с ошибкой "Неверный CVV код"

Если cvv равен null - возвращается 400 с ошибкой "Неверный CVV код"

e. Валидация order_number:

Если order_number содержит более 16 символов - возвращается 400 с ошибкой "Неверный номер заказа"

Если order_number равен null - возвращается 400 с ошибкой "Неверный номер заказа"

f. Валидация sum:

Если sum содержит неправильный числовой формат - возвращается 400 с ошибкой "Неверная сумма оплаты"

Если sum отрицательная - возвращается 400 с ошибкой "Неверная сумма оплаты"

Если sum равна нулю - возвращается 400 с ошибкой "Неверная сумма оплаты"

Если sum равна null - возвращается 400 с ошибкой "Неверная сумма оплаты"

Тестирование взаимодействия с сервисом A
g. Тестирование успешного ответа от сервиса A:

При получении HTTP 200 от сервиса A - вызывается setOrderIsPaid с правильными параметрами

h. Тестирование ошибок от сервиса A:

При получении HTTP 403 от сервиса A - возвращается ошибка "Не удалось списать средства с карты"

При таймауте соединения с сервисом A - возвращается ошибка "Сервис оплаты временно недоступен"

При получении HTTP 500 от сервиса A - возвращается ошибка "Внутренняя ошибка сервиса оплаты"

Тестирование взаимодействия с репозиторием
i. Тестирование успешного сохранения в БД:

При успешном вызове setOrderIsPaid - возвращается успешный ответ

j. Тестирование ошибок репозитория:

При исключении от setOrderIsPaid - возвращается ошибка "Ошибка при сохранении данных оплаты"

2. Интеграционные тесты (Integration Tests)
Проверяем связку «фронт-бэк»
a. Обработка ошибок валидации на фронте:

Если card_holder содержит более одного пробела, то после получения ответа от бэка на фронте выделяется поле "Имя владельца карты" красной рамкой и отображается сообщение об ошибке

Если card_number содержит нецифровые символы, то поле "Номер карты" выделяется красной рамкой

Если card_expiration содержит неверный формат, то поле "Срок действия" выделяется красной рамкой

Если cvv содержит менее 3 цифр, то поле "CVV" выделяется красной рамкой

b. Обработка успешных сценариев на фронте:

При успешной оплате отображается сообщение "Оплата прошла успешно" и кнопка "Вернуться к просмотру"

После успешной оплаты форма блокируется для повторного ввода

Проверяем связку «бэк-сервис A»
c. Тестирование корректности запроса к сервису A:

Проверяем, что все необходимые поля (card_number, card_holder, card_expiration, cvv, sum) передаются в правильном формате

Проверяем, что заголовки запроса содержат корректные данные аутентификации

d. Тестирование обработки ответов от сервиса A:

При успешном ответе (HTTP 200) бэк корректно обрабатывает ответ и передаёт управление репозиторию

При ошибке (HTTP 403) бэк корректно формирует сообщение об ошибке для фронта

При сетевых ошибках бэк корректно обрабатывает исключения и возвращает информативное сообщение

Проверяем связку «бэк-репозиторий»
e. Тестирование вызова репозитория:

Проверяем, что метод setOrderIsPaid вызывается с правильными параметрами (order_number и sum)

Проверяем, что при успешном сохранении в БД возвращается корректный ответ

f. Тестирование обработки ошибок репозитория:

При исключении от репозитория бэк корректно логирует ошибку и возвращает сообщение пользователю

Проверяем, что при ошибке репозитория не происходит повторных попыток списания средств

3. Системные тесты (System Tests)
Тестирование полного потока оплаты
a. Сценарий успешной оплаты:

Пользователь вводит корректные данные карты, система успешно обрабатывает платеж, отображает сообщение об успехе и разблокирует доступ к фильму

Проверяется, что в БД корректно сохраняется информация об оплате

b. Сценарии ошибок оплаты:

Если cvv неверен, то после получения ответа от бэка на фронте выводится сообщение об ошибке "Не удалось списать данные с карты, проверьте реквизиты"

Если на карте недостаточно средств (сервис A возвращает 403), пользователь видит сообщение "Недостаточно средств на карте"

При вводе просроченной карты пользователь видит сообщение "Срок действия карты истёк"

c. Тестирование отказоустойчивости:

При временной недоступности сервиса A пользователь видит сообщение "Сервис оплаты временно недоступен, попробуйте позже"

При проблемах с сетью форма предлагает повторить попытку через некоторое время

d. Тестирование безопасности:

Проверяется, что данные карты не сохраняются в логах в открытом виде

Проверяется защита от повторной отправки формы (double submission protection)

Рекомендации по удешевлению тестирования
Использование тестового окружения сервиса A с тестовыми картами для избежания реальных списаний

Мокирование сервиса A в модульных и интеграционных тестах

Тестовая БД с изолированными данными для каждого теста

Rate limiting для предотвращения множественных тестовых запросов

Отдельный стенд для тестирования с настроенными лимитами на операции