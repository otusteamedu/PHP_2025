## Модульные тесты

1. Если в запросе передан невалидный json, то метод возвращает `400` с сообщением об ошибке **"Некорректный формат входных данных"**.

### Валидация card_number

1. Если длина `card_number` не равна 16 символам, то метод возвращает `400` с сообщением об ошибке **"Некорректный номер карты"**.
2. Если `card_number` содержит любые символы кроме цифр, то метод возвращает `400` с сообщением об ошибке **"Некорректный номер карты"**.
3. Если `card_number` содержит ровно 16 цифр, то `card_number` валиден.

### Валидация card_holder

1. Если `card_holder` - пустая строка, то метод возвращает `400` с сообщением об ошибке **"Заполните имя владельца карты"**.
2. Если `card_holder` содержит более одного пробела, то тестируемый метод возвращает `400` с сообщением об ошибке **"Некорректное имя владельца карты"**.
3. Если `card_holder` содержит более одного дефиса, то тестируемый метод возвращает `400` с сообщением об ошибке **"Некорректное имя владельца карты"**.
4. Если `card_holder` не содержит ни одного пробела, то тестируемый метод возвращает `400` с сообщением об ошибке **"Некорректное имя владельца карты"**.
5. Если `card_holder` не содержит хотя бы двух латинских букв, разделенных пробелом, то тестируемый метод возвращает `400` с сообщением об ошибке **"Некорректное имя владельца карты"**.
6. Если `card_holder` содержит любые символы кроме латинских букв, пробела и дефиса, то тестируемый метод возвращает `400` с сообщением об ошибке **"Имя владельца карты должно быть введено латинскими буквами"**.
7. Если `card_holder` содержит имя и фамилию, состоящие из латинских букв и разделенные одним пробелом, то `card_holder` валиден.
8. Если `card_holder` содержит имя и фамилию, состоящие из латинских букв, разделенные одним пробелом, и содержит ровно один дефис, то `card_holder` валиден.

### Валидация card_expiration

1. Если `card_expiration` - пустая строка, то метод возвращает `400` с сообщением об ошибке **"Заполните срок действия карты"**.
1. Если `card_expiration` не соответствует регулярному выражению `^\d{2}/\d{2}$`, то тестируемый метод возвращает `400` с сообщением об ошибке **"Некорректный срок действия карты"**.
3. Если `card_expiration` содержит значение месяца не в диапазоне 01-12, то метод возвращает `400` с сообщением об ошибке **"Некорректный месяц в сроке действия карты"**.
4. Если `card_expiration` содержит прошедшую дату, то метод возвращает `400` с сообщением об ошибке **"Срок действия карты истек"**.
5. Если `card_expiration` соответствует шаблону регулярному выражению `^\d{2}/\d{2}$`, содержит корректное значение месяца в диапазоне 01-12 и еще не прошедшую дату, то `card_expiration` валиден.

### Валидация cvv

1. Если длина `cvv` не равна 3 символам, то метод возвращает `400` с сообщением об ошибке **"Некорректный CVV-код"**.
2. Если `cvv` содержит любые символы кроме цифр, то метод возвращает `400` с сообщением об ошибке **"Некорректный CVV-код"**.
3. Если `cvv` содержит ровно 3 цифры, то `cvv` валиден.

### Валидация order_number

1. Если `order_number` - пустая строка, то метод возвращает `400` с сообщением об ошибке **"Заполните номер заказа"**.
2. Если длина `order_number` более 16 символов, то метод возвращает `400` с сообщением об ошибке **"Слишком длинное значение номера заказа"**.
3. Если передан номер несуществующего в БД заказа, то метод возвращает `400` с сообщением об ошибке **"Заказ не найден"**.
4. Если длина `order_number` находится в диапазоне 1..16 и заказ с данным номером существует в репозитории, то `order_number` валиден.

### Валидация sum

1. Если `sum` не соответствует регулярному выражению `^\d+,\d{2}$`, то тестируемый метод возвращает `400` с сообщением об ошибке **"Некорректный формат суммы оплаты"**.
2. Если передано значение суммы оплаты, которое не равно стоимости данного заказа в БД, то метод возвращает `400` с сообщением об ошибке **"Некорректная сумма оплаты"**.
3. Если `sum` соответствует регулярному выражению `^\d+,\d{2}$` и равна стоимости заказа в БД, то значение `sum` валидно.

Если все данные валидны, то передаем их в сервис А.

## Интеграционные тесты

### Связка «фронт - бэк»

1. Если `card_number` пустой или невалидный, то поле **«Номер карты»** выделяется красной рамкой и отображается сообщение об ошибке, которое пришло с бэка.
2. Если `card_holder` пустой или невалидный, то поле **«Имя владельца карты»** выделяется красной рамкой и отображается сообщение об ошибке, которое пришло с бэка.
3. Если `card_expiration` пустой или невалидный, то поле **«Срок действия карты»** выделяется красной рамкой и отображается сообщение об ошибке, которое пришло с бэка.
4. Если `cvv` пустой или невалидный, то поле **«CVV-код»** выделяется красной рамкой и отображается сообщение об ошибке, которое пришло с бэка.
5. Если `order_number` пустой или невалидный, то поле **«Номер заказа»** выделяется красной рамкой и отображается сообщение об ошибке, которое пришло с бэка.
6. Если `sum` пустой или невалидный, то поле **«Сумма оплаты»** выделяется красной рамкой и отображается сообщение об ошибке, которое пришло с бэка.
7. Если с бэка пришла ошибка `5xx`, то отображается сообщение об ошибке, которое пришло с бэка.

### Связка "бэк - сервис A"

1. Если сервис А вернул код `200`, то бэк пытается обновить статус оплаты заказа в БД с помощью репозитория.
2. Если сервис А вернул код `403`, бэк возвращает `502` с сообщением об ошибке, полученным от сервиса A.
3. Если сервис А недоступен, бэк возвращает `502` с сообщением об ошибке **"Платежный сервис недоступен"**.

### Связка "бэк - репозиторий"

1. Если `setOrderIsPaid` возвращает **true**, бэк возвращает `200` с сообщением **"Оплата успешно выполнена"**.
2. Если `setOrderIsPaid` выбрасывает исключение, бэк возвращает `502` с сообщением **"Ошибка обновления статуса заказа"**.

## Системные тесты

**1. Проверка сценария успешной оплаты**

1.1. Ввести корректные данные карты, номер заказа и сумму оплаты.

1.2. Убедиться, что деньги списались, статус оплаты заказа обновился и на фронте вывелось сообщение **"Оплата успешно выполнена"**.

**2. Проверка ошибки при недостаточном количестве средств**

2.1. Ввести сумму оплаты, превышающую доступное количество средств на карте.

2.2. Убедиться, что на фронте вывелось сообщение **"Не удалось списать средства с карты, недостаточно средств"**.

**3. Проверка неверного CVV-кода**

3.1. Ввести неверный CVV-код.

3.2. Убедиться, что на фронте вывелось сообщение об ошибке **«Не удалось списать данные с карты, проверьте реквизиты»**.

**4. Проверка несуществующего номера заказа**

4.1. Ввести несуществующий номер заказа.

4.2. Убедиться, что на фронте поле **"Номер заказа"** выделилось красной рамкой и вывелось сообщение **"Заказ не найден"**.

**5. Проверка некорректной суммы оплаты**

5.1. Ввести сумму оплаты, несоответствующую стоимости заказа с введенным номером заказа.

5.2. Убедиться, что на фронте поле **"Сумма оплаты"** выделилось красной рамкой и вывелось сообщение **"Некорректная сумма оплаты"**.

**6. Проверка некорректного номера карты**

6.1. Ввести некорректный номер карты (например, 10 цифр).

6.2. Убедиться, что на фронте поле **"Номер карты"** выделилось красной рамкой и вывелось сообщение **"Некорректный номер карты"**.

**7. Проверка ошибки при обновлении статуса заказа в БД.**

7.1. Ввести корректные данные карты, номер заказа и сумму оплаты. 

7.2. Симулировать сбой в методе `setOrderIsPaid` репозитория.

7.3. Убедиться, что на фронте вывелось сообщение **"Ошибка обновления статуса заказа"**.

**8. Проверка недоступности сервиса А.**

8.1. Ввести корректные данные карты, номер заказа и сумму оплаты.

8.2. Симулировать недоступность сервиса А.

8.3. Убедиться, что на фронте вывелось сообщение **"Платежный сервис недоступен"**.

## Способы удешевления тестирования

1. Использовать тестовую БД или моковый репозиторий при тестировании работы репозитория во избежание повреждения реальных данных.
2. Использовать моковый сервис А во избежание реальных списаний денежных средств.
3. Если платежный сервис А предоставляет тестовое API, то использовать его при тестировании.
