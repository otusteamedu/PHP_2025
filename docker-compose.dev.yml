services:
  balancer:
    build:
      context: .
      dockerfile: docker/balancer/balancer.Dockerfile
    image: otus-php-hw04/balancer:latest
    ports:
      - "80:80"

  nginx-backend1:
    # üõ† –°—Ç—Ä–æ–∏–º –æ–±—Ä–∞–∑ –∏ –º–æ–Ω—Ç–∏—Ä—É–µ–º —Ç–æ–º–∞ –¢–û–õ–¨–ö–û –≤ –ø–µ—Ä–≤–æ–º backend-—Å–µ—Ä–≤–∏—Å–µ
    # –≠—Ç–æ—Ç –æ–±—Ä–∞–∑ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—Å–µ–º–∏ backend-—Ä–µ–ø–ª–∏–∫–∞–º–∏
    build:
      context: .
      dockerfile: docker/nginx/nginx.Dockerfile
    image: otus-php-hw04/nginx-backend:latest
    volumes:
      - ./nginx/conf.d:/etc/nginx/conf.d:ro
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./public:/app/public
      - php_fpm_socket1:/var/run/php

  nginx-backend2:
    # üîÅ –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Å–±–æ—Ä–∫–∏
    # –ë–µ–∑ volumes, —á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤ dev-–æ–∫—Ä—É–∂–µ–Ω–∏–∏
    image: otus-php-hw04/nginx-backend:latest
    volumes:
      - php_fpm_socket2:/var/run/php

  php-fpm1:
    build:
      context: .
      dockerfile: docker/php/php.Dockerfile
    image: otus-php-hw04/php-fpm:latest
    volumes:
      - ./src:/app/src
      - ./docker/php/php.ini:/usr/local/etc/php/conf.d/local.ini
      - php_fpm_socket1:/var/run/php
    environment:
      - COMPOSER_HOME=/var/www/.composer

  php-fpm2:
    image: otus-php-hw04/php-fpm:latest
    volumes:
      - php_fpm_socket2:/var/run/php

  redis:
    image: redis:alpine
    ports:
      - "6379:6379"
