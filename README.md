# PHP_2025

https://otus.ru/lessons/razrabotchik-php/?utm_source=github&utm_medium=free&utm_campaign=otus

# EAV модель

## Цель:

Потренироваться в написании сложных SQL-запросов поверх схемы для проверки правильности структуры.
Усилить схему гибким хранением значений различного типа без нарушения нормализации.

## Описание/Пошаговая инструкция выполнения домашнего задания:


Спроектировать EAV-хранение для базы данных кинотеатра


4 таблицы: фильмы, атрибуты, типы атрибутов, значения.


Типы атрибутов и соответствующие им атрибуты (для примера):


- рецензии (текстовые значения) - рецензии критиков, отзыв неизвестной киноакадемии ...

- премия (заменяется при печати баннеров и билетов на изображение, логическое значение) - оскар, ника ...

- "важные даты" даты (при печати - наименование атрибута и значение даты, тип дата) - мировая премьера, премьера в РФ ...

- служебные даты (используются при планировании, тип дата) - дата начала продажи билетов, когда запускать рекламу на ТВ ...


View сборки служебных данных в форме:

- фильм, задачи актуальные на сегодня, задачи актуальные через 20 дней

View сборки данных для маркетинга в форме (три колонки):

- фильм, тип атрибута, атрибут, значение (значение выводим как текст)

Критерии оценки:

    Учтены все допустимые типы данных;
    Учтена специфика хранения и последующего использования float-данных;
    EAV-схема оснащена индексами.

## Представление

Логическая модель для системы управления кинотеатром - PlantUML.png.
PlantUML сгенерирован с помощью бесплатного ресурса - https://www.plantuml.com/plantuml

## Использование

1. Разворот локальной базы данных

```docker run --name my-postgres -e POSTGRES_PASSWORD=mysecretpassword -d -p 5432:5432 postgres```
    
2. Скопируйте scripts с хоста в контейнер:

```docker cp scripts my-postgres:/scripts_cinema_eav_db```

3. Подключение к контейнеру:

```docker exec -it my-postgres bash```

4. Подключение к PostgreSQL:

```psql -U postgres```

5. Создание базы данных:

```CREATE DATABASE cinema_eav_db;```

6. Выход из postgres:

```\q```

7. Выполнение DDL-скрипта:

```psql -U postgres -d cinema_eav_db -f /scripts_cinema_eav_db/ddl.sql```

8. Выполнение DML-скрипта:

```psql -U postgres -d cinema_eav_db -f /scripts_cinema_eav_db/dml.sql```

9. Выполнение SQL-скрипты для создания индексов:

```psql -U postgres -d cinema_eav_db -f /scripts_cinema_eav_db/indexes.sql```

10. Выполнение SQL-скрипты для создания представлений:

```psql -U postgres -d cinema_eav_db -f /scripts_cinema_eav_db/views.sql```

11. Выполнение SQL-скрипты с примерами запросов к базе данных:

```psql -U postgres -d cinema_eav_db -f /scripts_cinema_eav_db/queries.sql```

P.S. Подключение к базе данных cinema_eav_db:

```psql -h localhost -p 5432 -U postgres -d cinema_eav_db```
