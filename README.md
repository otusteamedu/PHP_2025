## Модульные тесты:

1. Если `card_number` содержит не 16 цифр – ошибка 400 и сообщение "Некорректный номер карты".

2. Если `card_holder` пустой – ошибка 400 и сообщение "Введите имя держателя карты".

3. Если `card_holder` содержит символы, кроме латинских букв – ошибка 400, сообщение "Имя должно быть латиницей".

4. Если `card_expiration` не в формате мм/гг – ошибка 400, сообщение "Неверный формат срока действия".

5. Если `card_expiration` прошедшая дата – ошибка 400, сообщение "Срок действия карты истёк".

6. Если `cvv` не из 3 цифр – ошибка 400, сообщение "Неверный CVV-код".

7. Если `order_number` пустой или более 16 символов – 400, сообщение "Неверный номер заказа".

8. Если `sum` не число – ошибка 400, сообщение "Неверная сумма заказа". Тут нужно уточнить, что мы можем принять и значение "100.50" и "100,50" и самостоятельно привести к нужному типу.

9. Если сервис A возвращает 403, сообщение "Не удалось списать средства".

10. Если сервис A возвращает 200, но setOrderIsPaid вернул false – 500, сообщение "Ошибка при подтверждении оплаты".

11. Если setOrderIsPaid выбрасывает исключение – 500, сообщение "Ошибка при записи в базу".

12. Если все поля валидны и сервис A возвращает 200 (скорее всего mock от сервиса A), а setOrderIsPaid возвращает true – ответ 200, сообщение "Оплата прошла успешно".

13. Если `sum` передаётся в виде "100.50" (с точкой), она корректно преобразуется и принимается – оплата проходит.

## Интеграционные тесты:

### a. Связка фронт → бэк

1. Если поле card_holder = "", то на фронте поле "Имя владельца" выделяется красной рамкой, и появляется сообщение "Введите имя и фамилию".

2. Если поле card_number = "1234" (не 16 цифр), то выделяется поле "Номер карты" красной рамкой, сообщение "Некорректный номер карты".

3. Если поле card_expiration = "01/20" (истекла) — выделяется поле "Срок действия", появляется "Срок действия карты истёк".

4. Если поле sum = "abc", появляется сообщение "Неверная сумма заказа" (думаю это маловероятный сценарий, сумму устанавливает не клиент сервиса)

### b. Связка бэк → репозиторий

1. Если передан корректный order_number = "AB123", сумма "100,50" и сервис A возвращает 200 — проверяется, что setOrderIsPaid() вызывается с orderNumber = "AB123" и sum = 100.50.

2. Если сумма не совпадает с заказом — setOrderIsPaid() возвращает false, бэк отдаёт 500, сообщение "Ошибка при подтверждении оплаты".

## Системные тесты:

1. Если cvv = "000" (тестовый неправильный код), сервис A возвращает 403 — фронт показывает сообщение: "Не удалось списать средства, проверьте реквизиты карты".

2. Если пользователь ввёл корректные данные, сервис A вернул 200, сумма и заказ совпали фронт показывает сообщение: "Оплата прошла успешно", и пользователь перенаправляется на страницу просмотра фильма.

3. Если база недоступна — фронт показывает сообщение: "Внутренняя ошибка, попробуйте позже".

4. Если поле card_holder = "" — нажатие кнопки оплаты не вызывает отправку запроса, появляется сообщение под полем: "Это поле обязательно".

На счет стоимости тестов с реальными деньгами, вроде бы все эквайринг серивисы имеют тестовые режимы. На боевом, как вариант, можно сделать специальную страницу с фильмом за 1₽ и проводить реальные оплаты там, в моей практике такое было.
