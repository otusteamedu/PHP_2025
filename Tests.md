1. Модульные тесты (тестируем валидацию и обработку данных в бэкенде)
   Цель: Проверить корректность валидации входных данных и обработку ошибок.

a. Валидация card_holder:
Если card_holder содержит более одного пробела → возвращается 400 с ошибкой.
Если card_holder содержит цифры или спецсимволы (кроме дефиса) → 400.
Если card_holder пустой → 400.

b. Валидация card_number:
Если card_number не состоит из 16 цифр → 400.
Если card_number содержит буквы → 400.

c. Валидация card_expiration:
Если формат не мм/гг → 400.
Если месяц не в диапазоне 01-12 → 400.
Если год меньше текущего → 400.

d. Валидация cvv:
Если cvv не 3 цифры → 400.
Если cvv содержит буквы → 400.

e. Валидация sum:
Если sum не число с запятой (например, 100,50) → 400.
Если sum ≤ 0 → 400.

f. Валидация order_number:
Если order_number пустой → 400.
Если order_number длиннее 16 символов → 400.

g. Обработка успешного запроса:
Если все данные корректны → вызывается API сервиса A.

h. Обработка ответа от сервиса A:
Если сервис A вернул 403 → возвращается 403 с ошибкой.
Если сервис A вернул 200 → вызывается setOrderIsPaid.

i. Обработка ответа от репозитория:
Если setOrderIsPaid вернул true → возвращается 200.
Если setOrderIsPaid выбросил исключение → возвращается 500.

2. Интеграционные тесты (проверяем взаимодействие модулей)
a. Связка «фронт ↔ бэк»:
Если card_holder содержит более одного пробела → фронт выделяет поле красной рамкой.
Если card_expiration неверный → фронт показывает сообщение "Неверный срок действия карты".

b. Связка «бэк ↔ сервис A»:
Если сервис A возвращает 403 → бэк возвращает фронту "Не удалось списать средства".
Если сервис A возвращает 200 → бэк вызывает setOrderIsPaid.

c. Связка «бэк ↔ репозиторий»:
Если setOrderIsPaid возвращает true → бэк возвращает 200.
Если setOrderIsPaid выбрасывает исключение → бэк возвращает 500.

3. Системные тесты (проверяем полный сценарий работы системы)
a. Ошибка в CVV:
Пользователь вводит неверный cvv → фронт показывает "Не удалось списать данные с карты, проверьте реквизиты".

b. Успешная оплата:
Все данные корректны → сервис A списывает деньги → репозиторий подтверждает оплату → фронт показывает "Оплата прошла успешно".

c. Ошибка в сервисе A:
Сервис A недоступен → фронт показывает "Платёжный сервис временно не работает".

d. Ошибка в репозитории:
setOrderIsPaid возвращает ошибку → фронт показывает "Ошибка обработки платежа".

Оптимизация тестирования (снижение затрат)
Мокирование сервиса A:
В модульных и интеграционных тестах не вызываем реальный API, а используем заглушки.
Например, эмулируем ответы 200/403 без реальных списаний.
Тестовые данные в репозитории:
Используем in-memory БД или фиктивные данные для setOrderIsPaid.
Лимиты на системные тесты:
Реальные вызовы сервиса A выполняются только в CI/CD на тестовом окружении с тестовыми картами.

