#!/bin/bash

if command -v awk &> /dev/null; then
    # Предполагаем, что данные хранятся в файле table.txt
    # Пропускаем первую строку (заголовки), извлекаем 3-е поле (city),
    # обрабатываем только строки, где есть минимум 3 поля (чтобы исключить пустые строки и строки с недостаточным количеством данных)
    # сортируем, подсчитываем количество повторений, сортируем по убыванию,
    # и берем топ-3
    awk 'NR>1 && NF>=3 {print $3}' table.txt | sort | uniq -c | sort -nr | head -n 3
else
    # Обработка файла table.txt без использования awk
    # Пропускаем заголовок,
    # удаляем полностью пустые строки и строки с недостаточным количеством полей,
    # извлекаем город (3-е поле), удаляем возможные пустые значения города,
    # сортируем, подсчитываем, сортируем по убыванию и берем топ-3
    grep -v '^[[:space:]]*$' table.txt |   # Удаляем полностью пустые строки (включая с пробелами)
    tail -n +2 |                           # Пропускаем заголовок
    grep -v '^[[:space:]]*$' |             # Еще раз на случай пустых строк после заголовка
    grep -E '^[[:space:]]*[^[:space:]]+[[:space:]]+[^[:space:]]+[[:space:]]+[^[:space:]]+' | # Только строки с ≥3 полями
    sed 's/^[[:space:]]*//;s/[[:space:]]\+/ /g' | # Нормализуем пробелы
    cut -d' ' -f3 |                        # Извлекаем 3-е поле (город)
    grep -v '^[[:space:]]*$' |             # Удаляем пустые города
    sort | uniq -c | sort -nr | head -n 3  # Статистика по городам
fi
