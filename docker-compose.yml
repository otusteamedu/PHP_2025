# в этом блоке мы описываем контейнеры, которые будут запускаться
services:
  #контейнер с Nginx
  nginx-balancer:
    build:
      context: ./nginx-balancer
      dockerfile: Dockerfile
    image: myapp/nginx-balancer
    container_name: "nginx-balancer"
    # проброс портов
    ports:
      - "80:80"
    depends_on:
      - phpfpm1
      - phpfpm2
      - nginx1
      - nginx2
    networks:
      - nginx-balancer

  nginx1:
    build:
      context: ./nginx
      dockerfile: Dockerfile
    image: myapp/nginx
    container_name: "nginx1"
    # проброс портов
    volumes:
       - ./code:/var/www/data/homework
    depends_on:
      - phpfpm1
      - phpfpm2
    networks:
      - nginx-balancer

  nginx2:
    build:
      context: ./nginx
      dockerfile: Dockerfile
    image: myapp/nginx
    container_name: "nginx2"
    # проброс портов
    volumes:
       - ./code:/var/www/data/homework
    depends_on:
      - phpfpm1
      - phpfpm2
    networks:
      - nginx-balancer


  phpfpm1:
    build:
      context: ./php
      dockerfile: Dockerfile
    image: myapp/php 
    container_name: phpfpm1 
    volumes:
       - ./code:/var/www/data/homework
    networks:
      - nginx-balancer

  phpfpm2:
    build:
      context: ./php
      dockerfile: Dockerfile
    image: myapp/php 
    container_name: phpfpm2 
    volumes:
       - ./code:/var/www/data/homework
    networks:
      - nginx-balancer

  redis:
    image: 'redis:alpine'
    networks:
      - nginx-balancer

networks:
  nginx-balancer:
    driver: bridge