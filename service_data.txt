CREATE VIEW service_data AS
SELECT
    f.title AS film,
    COALESCE(MAX(CASE WHEN a.name = 'Дата начала продажи билетов' THEN av.value_date END), 'No Date') AS task_today,
    COALESCE(MAX(CASE WHEN a.name = 'Когда запускать рекламу на ТВ' THEN av.value_date END), 'No Date') AS task_in_20_days
FROM films f
JOIN attribute_values av ON f.id = av.film_id
JOIN attributes a ON av.attribute_id = a.id
WHERE av.value_date >= CURRENT_DATE
GROUP BY f.id;